# 認証機能 - 詳細設計書

## 機能概要
システム部管理タブへのアクセスを保護する認証機能

## パスワードハッシュ化
- SHA256アルゴリズム使用
- `system_settings` テーブルに保存

## 初期パスワード
- `admin123`（運用時に変更推奨）

## 実装
```python
import hashlib

def hash_password(password):
    return hashlib.sha256(password.encode()).hexdigest()

def verify_password(password, hashed):
    return hash_password(password) == hashed
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
EOF			
cat > docs/modules/ログ記録機能.md << 'EOF'

ログ記録機能 - 詳細設計書
機能概要
全ての操作を operation_logs テーブルに記録

記録対象
作成
更新
削除
ロック
ロック解除
認証成功/失敗
記録内容
ユーザー名（PCユーザー名）
PC名
操作種別
対象テーブル
対象レコードID
変更前データ（JSON）
変更後データ（JSON）
タイムスタンプ
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
EOF			
ui/ 配下の設計書を作成
cat > docs/ui/画面遷移図.md << 'EOF'

画面遷移図
メイン画面構成
起動
  ↓
メインウィンドウ
  ├─ 訂正入力タブ
  │   ├─ 訂正依頼一覧
  │   ├─ 入力エリア
  │   └─ 確認ダイアログ
  │
  └─ システム部管理タブ
      ├─ パスワードダイアログ
      ├─ ロック済み依頼一覧
      └─ ログビューア
画面遷移
訂正入力タブ

入力 → 確認ダイアログ → 保存 → 一覧更新
システム部管理タブ

パスワード入力 → 認証 → 管理画面表示
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
EOF			
cat > docs/ui/訂正入力画面設計.md << 'EOF'

訂正入力画面設計
レイアウト
左側（65%）: 訂正依頼一覧
QTableView
検索ボックス
フィルタコンボボックス
操作ボタン（更新・編集・削除）
右側（35%）: 入力エリア
QScrollArea（スクロール可能）
訂正種別ラジオボタン
生徒選択コンボボックス
講座選択コンボボックス
対象日付/学期
訂正前/訂正後
理由テキストエリア
ボタン（決定・クリア・複製）
ウィジェット配置
┌─────────────────────┬─────────────────┐
│ 検索: [        ] 🔍 │ [訂正種別]      │
│ 種別: [全て▼]       │ ○出欠 ○評価    │
│ 状態: [全て▼]       │                 │
├─────────────────────┤ [生徒選択▼]    │
│ [訂正依頼一覧]      │                 │
│                     │ [講座選択▼]    │
│ ID | 種別 | 生徒... │                 │
│ ─────────────────   │ [対象日付]     │
│ 1  | 出欠 | 山田... │                 │
│ 2  | 評価 | 佐藤... │ [訂正前▼]      │
│                     │                 │
│ [更新][編集][削除]  │ [訂正後▼]      │
│                     │                 │
│                     │ [理由]          │
│                     │ ┌─────────────┐ │
│                     │ │             │ │
│                     │ └─────────────┘ │
│                     │                 │
│                     │ [決定][クリア]  │
└─────────────────────┴─────────────────┘
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
EOF			
cat > docs/ui/システム部管理画面設計.md << 'EOF'

システム部管理画面設計
認証画面
┌─────────────────────────┐
│ システム部管理 - 認証   │
├─────────────────────────┤
│ パスワード:             │
│ [******************]    │
│                         │
│         [OK]            │
└─────────────────────────┘
管理画面レイアウト
┌─────────────────────────────────┐
│ [ロック済み依頼] [操作ログ]     │
├─────────────────────────────────┤
│                                 │
│ ロック済み依頼一覧              │
│ ┌─────────────────────────────┐ │
│ │ ID | 種別 | 生徒 | ロック者 │ │
│ ├─────────────────────────────┤ │
│ │ 1  | 出欠 | 山田 | admin    │ │
│ └─────────────────────────────┘ │
│                                 │
│ [ロック解除]                    │
│                                 │
└─────────────────────────────────┘
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
EOF			
api/ 配下の設計書を作成
cat > docs/api/データベースAPI仕様.md << 'EOF'

データベースAPI仕様
DatabaseManager クラス
メソッド一覧
__init__(db_path)
データベース接続を初期化

get_connection()
コンテキストマネージャーで接続を取得

Copywith db.get_connection() as conn:
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM students")
execute(query, params=None)
クエリを実行

Copydb.execute("SELECT * FROM students WHERE year = ?", (2025,))
execute_many(query, params_list)
複数行を一括挿入

Copydb.execute_many(
    "INSERT INTO students (name) VALUES (?)",
    [("山田",), ("佐藤",), ("鈴木",)]
)
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
EOF			
cat > docs/api/コントローラーAPI仕様.md << 'EOF'

コントローラーAPI仕様
CorrectionController クラス
メソッド一覧
create_request(data)
訂正依頼を作成

引数:

data: 訂正依頼データ（dict）
戻り値:

correction_id: 作成された訂正ID
update_request(correction_id, data)
訂正依頼を更新

delete_request(correction_id)
訂正依頼を削除（論理削除）

get_request(correction_id)
訂正依頼を取得

get_all_requests(filters=None)
訂正依頼一覧を取得

LogController クラス
メソッド一覧
log_operation(...)
操作をログに記録

AuthController クラス
メソッド一覧
verify_password(password)
パスワードを検証

change_password(old_password, new_password)
パスワードを変更

更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
