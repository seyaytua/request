# 訂正依頼システム - 全体構成図

## プロジェクト概要

**プロジェクト名**: App_request  
**目的**: 学校における出欠訂正・評価評定変更の依頼管理システム  
**開発環境**: Python 3.11, PySide6, SQLite  
**配置**: Windows共有サーバー上で実行ファイルとして動作

---

## システムアーキテクチャ

┌─────────────────────────────────────────────────────────────┐ │ クライアントPC │ │ ┌──────────────────────────────────────────────────────┐ │ │ │ PySide6 デスクトップアプリ │ │ │ │ ┌──────────────┐ ┌──────────────────────────┐ │ │ │ │ │ 訂正入力 │ │ システム部管理 │ │ │ │ │ │ タブ │ │ タブ（パスワード保護） │ │ │ │ │ └──────────────┘ └──────────────────────────┘ │ │ │ │ │ │ │ │ │ │ └────────┬───────────┘ │ │ │ │ │ │ │ │ │ ┌──────────▼──────────┐ │ │ │ │ │ コントローラー層 │ │ │ │ │ │ - 訂正管理 │ │ │ │ │ │ - 認証管理 │ │ │ │ │ │ - ログ管理 │ │ │ │ │ └──────────┬──────────┘ │ │ │ │ │ │ │ │ │ ┌──────────▼──────────┐ │ │ │ │ │ データベース管理層 │ │ │ │ │ │ - CRUD操作 │ │ │ │ │ │ - トランザクション │ │ │ │ │ │ - ロック制御 │ │ │ │ │ └──────────┬──────────┘ │ │ │ └────────────────────┼──────────────────────────────────┘ │ └─────────────────────────┼───────────────────────────────────┘ │ SQLite接続 │ ┌─────────────────────────▼───────────────────────────────────┐ │ 共有サーバー │ │ ┌──────────────────────────────────────────────────────┐ │ │ │ corrections.db (SQLite) │ │ │ │ ┌──────────────┐ ┌──────────────────────────┐ │ │ │ │ │ students │ │ courses │ │ │ │ │ │ 生徒情報 │ │ 講座情報 │ │ │ │ │ └──────────────┘ └──────────────────────────┘ │ │ │ │ ┌──────────────────────────────────────────┐ │ │ │ │ │ correction_requests │ │ │ │ │ │ 訂正依頼（メインテーブル） │ │ │ │ │ └──────────────────────────────────────────┘ │ │ │ │ ┌──────────────┐ ┌──────────────────────────┐ │ │ │ │ │ operation_ │ │ system_settings │ │ │ │ │ │ logs │ │ システム設定 │ │ │ │ │ └──────────────┘ └──────────────────────────┘ │ │ │ └──────────────────────────────────────────────────────┘ │ └─────────────────────────────────────────────────────────────┘


---

## ディレクトリ構造

App_request/ ├── docs/ # 設計書 │ ├── 00_全体構成図.md │ ├── 01_主要機能一覧.md │ ├── 02_データベース設計.md │ ├── modules/ │ │ ├── 訂正入力機能.md │ │ ├── システム部管理機能.md │ │ ├── 認証機能.md │ │ └── ログ記録機能.md │ ├── ui/ │ │ ├── 画面遷移図.md │ │ ├── 訂正入力画面設計.md │ │ └── システム部管理画面設計.md │ └── api/ │ ├── データベースAPI仕様.md │ └── コントローラーAPI仕様.md │ ├── venv/ # 仮想環境 │ ├── src/ # ソースコード │ ├── main.py # エントリーポイント │ ├── config.py # 設定ファイル │ │ │ ├── database/ # データベース層 │ │ ├── init.py │ │ ├── db_manager.py # DB接続・トランザクション管理 │ │ ├── models.py # テーブルモデル定義 │ │ ├── init_db.py # 初期化スクリプト │ │ └── schema.sql # テーブル定義SQL │ │ │ ├── controllers/ # ビジネスロジック層 │ │ ├── init.py │ │ ├── correction_controller.py # 訂正依頼管理 │ │ ├── auth_controller.py # 認証管理 │ │ └── log_controller.py # ログ管理 │ │ │ ├── ui/ # UI層 │ │ ├── init.py │ │ ├── main_window.py # メインウィンドウ │ │ ├── correction_tab.py # 訂正入力タブ │ │ ├── admin_tab.py # システム部管理タブ │ │ │ │ │ ├── dialogs/ # ダイアログ │ │ │ ├── init.py │ │ │ ├── confirmation_dialog.py # 確認ダイアログ │ │ │ ├── password_dialog.py # パスワード入力 │ │ │ └── correction_form.py # 訂正入力フォーム │ │ │ │ │ └── widgets/ # カスタムウィジェット │ │ ├── init.py │ │ ├── correction_list.py # 訂正依頼リスト │ │ ├── scrollable_input_area.py # スクロール入力エリア │ │ └── log_viewer.py # ログビューア │ │ │ └── utils/ # ユーティリティ │ ├── init.py │ ├── system_info.py # システム情報取得 │ ├── password_hash.py # パスワードハッシュ化 │ ├── logger.py # ロギング │ └── validators.py # バリデーション │ ├── data/ # データファイル │ └── corrections.db # SQLiteデータベース │ ├── resources/ # リソースファイル │ ├── icons/ # アイコン │ └── styles/ # スタイルシート │ ├── tests/ # テストコード │ ├── test_database.py │ ├── test_controllers.py │ └── test_ui.py │ ├── requirements.txt # Python依存パッケージ ├── App_request.spec # PyInstaller設定 └── README.md # プロジェクト説明


---

## 技術スタック

| 分類 | 技術 | バージョン | 用途 |
|------|------|-----------|------|
| 言語 | Python | 3.11+ | メイン開発言語 |
| GUI | PySide6 | 6.6.0+ | デスクトップUI |
| DB | SQLite | 3.x | データ永続化 |
| ビルド | PyInstaller | 6.3.0+ | 実行ファイル化 |
| テスト | pytest | - | ユニットテスト |

---

## データフロー

### 1. 訂正依頼の作成フロー

ユーザー入力 ↓ 入力フォーム（複数可） ↓ 確認ダイアログ（1件ずつ） ↓ CorrectionController.create_request() ↓ バリデーション ↓ DatabaseManager.insert() ↓ LogController.log_operation() ↓ データベース保存 + ログ記録 ↓ UIに反映


### 2. 訂正依頼の更新フロー

リストから選択 ↓ ロック確認 ↓ 編集画面表示 ↓ 確認ダイアログ ↓ CorrectionController.update_request() ↓ 変更前データ取得 ↓ DatabaseManager.update() ↓ LogController.log_operation() ↓ 変更前後をログに記録 ↓ UIに反映


### 3. システム部管理アクセスフロー

システム部管理タブクリック ↓ パスワードダイアログ表示 ↓ AuthController.verify_password() ↓ 認証成功 ↓ 管理画面表示 - ロック済み依頼一覧 - 操作ログビューア


---

## セキュリティ設計

### 1. アクセス制御
- システム部管理タブはパスワード保護
- パスワードはSHA256ハッシュ化してDB保存
- 初期パスワード: `admin123`（変更推奨）

### 2. データ保護
- SQLインジェクション対策: プリペアドステートメント使用
- 削除は論理削除（`is_deleted`フラグ）
- 全操作をログに記録

### 3. 並行制御
- SQLite WALモード有効化
- Pythonレベルでのロック制御（`threading.Lock`）
- タイムアウト設定: 30秒

---

## 配置構成

### 共有サーバー配置
\shared-server\App_request
├── 訂正依頼システム.exe # 実行ファイル ├── corrections.db # データベース └── resources/ # リソースファイル ├── icons/ └── styles/


### クライアントPC要件
- OS: Windows 10/11
- メモリ: 4GB以上推奨
- .NET Framework: 不要（Python同梱）

---

## 開発フェーズ

### Phase 1: 基盤構築（1週目）
- [ ] データベース設計・作成
- [ ] 基本的なCRUD操作実装
- [ ] メインウィンドウの骨組み

### Phase 2: 訂正入力機能（2週目）
- [ ] 訂正入力画面実装
- [ ] 確認ダイアログ実装
- [ ] 複製機能実装
- [ ] バリデーション実装

### Phase 3: システム管理機能（3週目）
- [ ] 認証機能実装
- [ ] ロック機能実装
- [ ] ログビューア実装

### Phase 4: 仕上げ（4週目）
- [ ] エラーハンドリング
- [ ] UI/UX改善
- [ ] テスト
- [ ] 実行ファイル化
- [ ] ドキュメント整備

---

## 運用想定

### 利用者
- **一般教員**: 訂正依頼の作成・確認
- **システム部**: 全データの管理・ロック・ログ確認

### 利用シーン
1. 教員が出欠を間違えて入力した場合の訂正依頼
2. 評価・評定の変更が必要になった場合の変更依頼
3. システム部が依頼内容を確認してロック
4. 最終的に成績システムに反映

---

## 更新履歴

| 日付 | バージョン | 更新内容 | 担当者 |
|------|-----------|---------|--------|
| 2025-10-17 | 1.0 | 初版作成 | - |
