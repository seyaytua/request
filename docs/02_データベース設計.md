# 訂正依頼システム - データベース設計

## データベース概要
- **DBMS**: SQLite 3.x
- **ファイル名**: corrections.db
- **配置場所**: 実行ファイルと同じディレクトリ（共有サーバー）
- **文字コード**: UTF-8

## 主要な変更点（v1.1）
1. **組番号**: 5文字形式（例: F1221, J2123）
2. **学期**: 数値 → 文字列（前期中間、前期期末、後期中間、仮評定、後期期末、評定）
3. **校時**: 新規追加（1限〜12限、最大2つ選択可能）
4. **依頼者**: 必須フィールドとして追加

## テーブル定義

### 1. students（生徒情報テーブル）

```sql
CREATE TABLE students (
    student_id INTEGER PRIMARY KEY AUTOINCREMENT,
    year INTEGER NOT NULL,
    class_number TEXT NOT NULL,                 -- 組番号（F1221, J2123など5文字）
    student_number TEXT,
    name TEXT NOT NULL,
    name_kana TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(year, class_number, student_number)
);
検索機能: 生徒氏名と組番号で部分検索可能

2. courses（講座情報テーブル）
CopyCREATE TABLE courses (
    course_id TEXT PRIMARY KEY,
    course_name TEXT NOT NULL,
    teacher_name TEXT,
    year INTEGER NOT NULL,
    semester TEXT,                              -- 前期中間、前期期末、後期中間、仮評定、後期期末、評定
    subject_code TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
検索機能: 講座名で部分検索可能

3. correction_requests（訂正依頼テーブル）
CopyCREATE TABLE correction_requests (
    correction_id INTEGER PRIMARY KEY AUTOINCREMENT,
    request_type TEXT NOT NULL CHECK(request_type IN ('出欠訂正', '評価評定変更')),
    student_id INTEGER NOT NULL,
    course_id TEXT NOT NULL,
    target_date TEXT,
    semester TEXT,                              -- 前期中間、前期期末、後期中間、仮評定、後期期末、評定
    periods TEXT,                               -- 校時（例: "1,2" 最大2つ）
    before_value TEXT,
    after_value TEXT,
    reason TEXT NOT NULL,
    requester_name TEXT NOT NULL,               -- 依頼者名（必須）
    requester_pc TEXT NOT NULL,
    request_datetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_locked BOOLEAN DEFAULT 0,
    locked_by TEXT,
    locked_datetime TIMESTAMP,
    status TEXT DEFAULT '未処理' CHECK(status IN ('未処理', '処理中', '完了')),
    is_deleted BOOLEAN DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (course_id) REFERENCES courses(course_id)
);
periods フィールド:

出欠訂正時に使用
カンマ区切りで最大2つの校時を保存
例: "1,2" → 1限と2限
更新履歴
日付	バージョン	更新内容	担当者
2025-10-17	1.0	初版作成	-
2025-10-17	1.1	組番号5文字化、校時追加、依頼者必須化、学期文字列化	-
